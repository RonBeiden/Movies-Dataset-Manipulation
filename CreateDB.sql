CREATE TABLE MediaItems(
	MID NUMERIC(11,0) PRIMARY KEY,
	PROD_YEAR NUMERIC(4,0),
	TITLE VARCHAR(100) 
);

CREATE TABLE Similarity(
	MID1 NUMERIC(11,0),
	MID2 NUMERIC(11,0),
	SIMILARITY REAL,
	CONSTRAINT pk_mid12 PRIMARY KEY(MID1, MID2),
	FOREIGN KEY (MID1) REFERENCES MediaItems(MID),
	FOREIGN KEY (MID2) REFERENCES MediaItems(MID)
);

GO
CREATE FUNCTION MaximalDistance
(
)
RETURNS NUMERIC(4,0)
AS
BEGIN
DECLARE @max_dif NUMERIC(4,0);
DECLARE @min_dif NUMERIC(4,0);
SELECT @max_dif = MAX(PROD_YEAR), @min_dif = MIN(PROD_YEAR) FROM MediaItems;
RETURN @max_dif - @min_dif;
END;

GO
CREATE FUNCTION SimCalculation
(
@MID1 NUMERIC(11,0),
@MID2 NUMERIC(11,0),
@maximal_distance smallint
)
RETURNS REAL
AS
BEGIN
DECLARE @similarity REAL;
DECLARE @distance NUMERIC(4,0);
DECLARE @MID_YEAR_1 NUMERIC(4,0);
DECLARE @MID_YEAR_2 NUMERIC(4,0);
SELECT @MID_YEAR_1 = PROD_YEAR FROM MediaItems WHERE MID = @MID1;
SELECT @MID_YEAR_2 = PROD_YEAR FROM MediaItems WHERE MID = @MID2;
SET @distance = ABS(@MID_YEAR_1 - @MID_YEAR_2);
SET @similarity = 1 - (@distance / @maximal_distance)
RETURN @similarity;
END;
